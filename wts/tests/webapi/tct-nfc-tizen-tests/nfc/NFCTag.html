<!DOCTYPE html>
<!--
Copyright (c) 2013 Samsung Electronics Co., Ltd.

Licensed under the Apache License, Version 2.0 (the License);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.


Authors:
        Piotr Szydelko <p.szydelko@samsung.com>

-->
<html>
<head>
<title>NFCTag</title>
<meta charset="utf-8"/>
<script type="text/javascript" src="support/unitcommon.js"></script>
<script type="text/javascript" src="support/nfc_common.js"></script>
</head>

<body>
<div id="log"></div>
<script>
//==== TEST: NFCTag
//==== LABEL Check NFCTag attributes, method existence and TypeMismatchError throwing
//==== EXECUTION_TYPE manual
//==== PRIORITY P3
//==== STEP Click "Run". Move NFC tag close so it will be detected.
//==== EXPECT Pass
//==== PRE Turn on NFC adapter. Prepare NFC tag.
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:isConnected A
//==== SPEC_URL https://developer.tizen.org/help/topic/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA AE AT ARO
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:isSupportedNDEF A
//==== SPEC_URL https://developer.tizen.org/help/topic/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA AE AT ARO
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:ndefSize A
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA AE AT ARO
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:properties A
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA AE AT ARO
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:type A
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA AE AT ARO
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:readNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA ME
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:readNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MC
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:readNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MTCB
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:readNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MC
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:readNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MTCB
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:readNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MMA
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:writeNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA ME
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:writeNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MC
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:writeNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MTO
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:writeNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MC
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:writeNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MTCB
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:writeNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MC
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:writeNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MTCB
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:writeNDEF M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MMA
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:transceive M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA ME
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:transceive M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MC
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:transceive M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MC
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:transceive M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MTCB
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:transceive M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MC
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:transceive M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MTCB
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:transceive M
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA MMA
//==== SPEC Tizen Web API:Communication:NFC:NFCTag:NFCTag U
//==== SPEC_URL https://developer.tizen.org/help/index.jsp?topic=/org.tizen.web.device.apireference/tizen/nfc.html
//==== TEST_CRITERIA OBX

setup({timeout: 90000});

var t = async_test(document.title, {timeout: 90000});


t.step(function () {
    var adapter, listener;

    listener = {
        onattach: t.step_func(function (tag) {
            //------------ NFCTag_isSupportedNDEF_attribute
            test(function () {
                assert_own_property(tag, "isSupportedNDEF", "NFCTag does not own isSupportedNDEF property.");
                // assume the tag used during tests supports NDEF
                check_readonly(tag, "isSupportedNDEF", true, "boolean", false);
            }, "NFCTag_isSupportedNDEF_attribute");

            //------------ NFCTag_ndefSize_attribute
            test(function () {
                assert_own_property(tag, "ndefSize", "NFCTag does not own ndefSize property.");
                assert_greater_than_equal(tag.ndefSize, 0, "tag.ndefSize should not be negative");
                check_readonly(tag, "ndefSize", tag.ndefSize, "number", tag.ndefSize + 1);
                assert_equals(tag.ndefSize, Math.floor(tag.ndefSize),
                    "tag.ndefSize should be integer");
            }, "NFCTag_ndefSize_attribute");

            //------------ NFCTag_properties_attribute
            test(function () {
                var readProperties, currentProperties, obj, testPropertyName = this.name + "_testProperty";

                assert_own_property(tag, "properties", "NFCTag does not own properties property.");
                assert_type(tag.properties, "object", "tag.properties");

                readProperties = Object.getOwnPropertyNames(tag.properties);
                readProperties.sort();

                obj = {};
                obj[testPropertyName] = "x";
                tag.properties = obj;
                currentProperties = Object.getOwnPropertyNames(tag.properties);
                currentProperties.sort();
                assert_array_equals(currentProperties, readProperties,
                    "properties should not be changed");

                check_not_nullable(tag, "properties");
            }, "NFCTag_properties_attribute");

            //------------ NFCTag_type_attribute
            test(function () {
                assert_own_property(tag, "type", "NFCTag does not own type property.");
                check_readonly(tag, "type", tag.type, "string", "-");
                assert_true(tag.type in NFCTagType,
                    "tag.type should be one of specified enum values");
            }, "NFCTag_type_attribute");


            //------------ NFCTag_isConnected_attribute
            test(function () {
                assert_own_property(tag, "isConnected", "NFCTag does not own isConnected property.");
                check_readonly(tag, "isConnected", true, "boolean", !tag.isConnected);
            }, "NFCTag_isConnected_attribute");

            //------------ NFCTag_readNDEF_exist
            test(function () {
                assert_true("readNDEF" in tag, "readNDEF should exist in tag");
                check_method_exists(tag, "readNDEF");
            }, "NFCTag_readNDEF_exist");

            //------------ NFCTag_readNDEF_readCallback_TypeMismatch
            test(function () {
                var i, badValues, value, exceptionName;

                badValues = getTypeConversionExceptions("functionObject", false);

                for (i = 0; i < badValues.length; i++) {
                    value = badValues[i][0];
                    exceptionName = badValues[i][1];
                    assert_throws({
                            name: exceptionName
                        }, function () {
                            tag.readNDEF(value);
                        }, "[readCallback = " + value + "]"
                    );
                }
            }, "NFCTag_readNDEF_readCallback_TypeMismatch");

            //------------ NFCTag_readNDEF_readCallback_invalid_cb
            test(function () {
                var invalidCallback = {
                    onsuccess: t.step_func(function () {
                        assert_unreached("Wrong callback");
                    })
                };

                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.readNDEF(invalidCallback);
                });
            }, "NFCTag_readNDEF_readCallback_invalid_cb");

            //------------ NFCTag_readNDEF_errorCallback_TypeMismatch
            test(function () {
                var i, badValues, value, exceptionName;

                badValues = getTypeConversionExceptions("functionObject", true);

                for (i = 0; i < badValues.length; i++) {
                    value = badValues[i][0];
                    exceptionName = badValues[i][1];
                    assert_throws({
                            name: exceptionName
                        }, function () {
                            tag.readNDEF(t.step_func(assert_unreached), value);
                        }, "[errorCallback = " + value + "]"
                    );
                }
            }, "NFCTag_readNDEF_errorCallback_TypeMismatch");

            //------------ NFCTag_readNDEF_errorCallback_invalid_cb
            test(function () {
                var invalidCallback = {
                    onerror: t.step_func(function () {
                        assert_unreached("Wrong callback");
                    })
                };

                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.readNDEF(t.step_func(assert_unreached), invalidCallback);
                });
            }, "NFCTag_readNDEF_errorCallback_invalid_cb");

            //------------ NFCTag_readNDEF_missarg
            test(function () {
                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.readNDEF();
                });
            }, "NFCTag_readNDEF_missarg");

            //------------ NFCTag_writeNDEF_exist
            test(function () {
                assert_true("writeNDEF" in tag, "transceive should exist in tag");
                check_method_exists(tag, "writeNDEF");
            }, "NFCTag_writeNDEF_exist");

            //------------ NFCTag_writeNDEF_ndefMessage_TypeMismatch
            test(function () {
                var i, badValues, value, exceptionName;

                badValues = getTypeConversionExceptions("object", false);

                for (i = 0; i < badValues.length; i++) {
                    value = badValues[i][0];
                    exceptionName = badValues[i][1];
                    assert_throws({
                            name: exceptionName
                        }, function () {
                            tag.writeNDEF(value);
                        }, "[ndefMessage = " + value + "]"
                    );
                }
            }, "NFCTag_writeNDEF_ndefMessage_TypeMismatch");

            //------------ NFCTag_writeNDEF_ndefMessage_invalid_obj
            test(function () {
                var invalidMessage = {
                    records: [],
                    recordCount: 0
                };

                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.writeNDEF(invalidMessage);
                });
            }, "NFCTag_writeNDEF_ndefMessage_invalid_obj");

            //------------ NFCTag_writeNDEF_successCallback_TypeMismatch
            test(function () {
                var i, badValues, value, exceptionName, message;

                badValues = getTypeConversionExceptions("functionObject", true);
                message = createNDEFTextMessage("writeNDEF_sc_TM");

                for (i = 0; i < badValues.length; i++) {
                    value = badValues[i][0];
                    exceptionName = badValues[i][1];
                    assert_throws({
                            name: exceptionName
                        }, function () {
                            tag.writeNDEF(message, value);
                        }, "[successCallback = " + value + "]"
                    );
                }
            }, "NFCTag_writeNDEF_successCallback_TypeMismatch");

            //------------ NFCTag_writeNDEF_successCallback_invalid_cb
            test(function () {
                var invalidCallback,
                    message = createNDEFTextMessage("writeNDEF_sc_ic");

                invalidCallback = {
                    onsuccess: t.step_func(function () {
                        assert_unreached("Wrong callback");
                    })
                };

                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.writeNDEF(message, invalidCallback);
                });
            }, "NFCTag_writeNDEF_successCallback_invalid_cb");

            //------------ NFCTag_writeNDEF_errorCallback_TypeMismatch
            test(function () {
                var i, badValues, value, exceptionName,
                    message = createNDEFTextMessage("writeNDEF_er_TM");

                badValues = getTypeConversionExceptions("functionObject", true);

                for (i = 0; i < badValues.length; i++) {
                    value = badValues[i][0];
                    exceptionName = badValues[i][1];
                    assert_throws({
                            name: exceptionName
                        }, function () {
                            tag.writeNDEF(message, t.step_func(assert_unreached), value);
                        }, "[errorCallback = " + value + "]"
                    );
                }
            }, "NFCTag_writeNDEF_errorCallback_TypeMismatch");

            //------------ NFCTag_writeNDEF_errorCallback_invalid_cb
            test(function () {
                var invalidCallback,
                    message = createNDEFTextMessage("writeNDEF_ec_ic");

                invalidCallback = {
                    onerror: t.step_func(function () {
                        assert_unreached("Wrong callback");
                    })
                };

                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.writeNDEF(message, t.step_func(assert_unreached), invalidCallback);
                });
            }, "NFCTag_writeNDEF_errorCallback_invalid_cb");

            //------------ NFCTag_writeNDEF_missarg
            test(function () {
                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.writeNDEF();
                });
            }, "NFCTag_writeNDEF_missarg");

            //------------ NFCTag_transceive_exist
            test(function () {
                assert_true("transceive" in tag, "transceive should exist in tag");
                check_method_exists(tag, "transceive");
            }, "NFCTag_transceive_exist");

            //------------ NFCTag_transceive_data_TypeMismatch
            test(function () {
                var i, badValues, value, exceptionName;

                badValues = getTypeConversionExceptions("array", false);

                for (i = 0; i < badValues.length; i++) {
                    value = badValues[i][0];
                    exceptionName = badValues[i][1];
                    assert_throws({
                            name: exceptionName
                        }, function () {
                            tag.transceive(value, t.step_func(assert_unreached));
                        }, "[data = " + value + "]"
                    );
                }
            }, "NFCTag_transceive_data_TypeMismatch");

            //------------ NFCTag_transceive_dataCallback_TypeMismatch
            test(function () {
                var i, badValues, value, exceptionName,
                    bytes = [];

                badValues = getTypeConversionExceptions("functionObject", false);

                for (i = 0; i < badValues.length; i++) {
                    value = badValues[i][0];
                    exceptionName = badValues[i][1];
                    assert_throws({
                            name: exceptionName
                        }, function () {
                            tag.transceive(bytes, value);
                        }, "[dataCallback = " + value + "]"
                    );
                }
            }, "NFCTag_transceive_dataCallback_TypeMismatch");

            //------------ NFCTag_transceive_dataCallback_invalid_cb
            test(function () {
                var invalidCallback, bytes = [];

                invalidCallback = {
                    onsuccess: t.step_func(function () {
                        assert_unreached("Wrong callback");
                    })
                };

                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.transceive(bytes, invalidCallback);
                });
            }, "NFCTag_transceive_dataCallback_invalid_cb");

            //------------ NFCTag_transceive_errorCallback_TypeMismatch
            test(function () {
                var i, badValues, value, exceptionName,
                    bytes = [];

                badValues = getTypeConversionExceptions("functionObject", true);

                for (i = 0; i < badValues.length; i++) {
                    value = badValues[i][0];
                    exceptionName = badValues[i][1];
                    assert_throws({
                            name: exceptionName
                        }, function () {
                            tag.transceive(bytes, t.step_func(assert_unreached), value);
                        }, "[errorCallback = " + value + "]"
                    );
                }
            }, "NFCTag_transceive_errorCallback_TypeMismatch");

            //------------ NFCTag_transceive_errorCallback_invalid_cb
            test(function () {
                var invalidCallback,
                    bytes = [];

                invalidCallback = {
                    onerror: t.step_func(function () {
                        assert_unreached("Wrong callback");
                    })
                };

                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.transceive(bytes, t.step_func(assert_unreached), invalidCallback);
                });
            }, "NFCTag_transceive_errorCallback_invalid_cb");

            //------------ NFCTag_transceive_missarg
            test(function () {
                assert_throws(TYPE_MISMATCH_EXCEPTION, function () {
                    tag.transceive([]);
                });
            }, "NFCTag_transceive_missarg");

            //------------ NFCTag_extend
            check_extensibility(tag);

            t.done();
        }),
        ondetach: t.step_func(function () {
            adapter.unsetTagListener();
        })
    };

    adapter = tizen.nfc.getDefaultAdapter();
    adapter.setTagListener(listener);

});

</script>
</body>
</html>
